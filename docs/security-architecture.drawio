<mxfile host="65bd71144e">
    <diagram id="system-architecture" name="1. System Architecture">
        <mxGraphModel dx="1422" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                
                <!-- Client Layer -->
                <mxCell id="2" value="CLIENT LAYER" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A90E2;strokeColor=#2E5C8A;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="40" y="40" width="720" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="3" value="React SPA&#xa;(Vite)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A90E2;strokeColor=#2E5C8A;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="80" y="80" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="4" value="Stripe.js&#xa;Elements" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A90E2;strokeColor=#2E5C8A;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="280" y="80" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="OAuth Popup&#xa;GitHub/Discord" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A90E2;strokeColor=#2E5C8A;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="480" y="80" width="160" height="60" as="geometry"/>
                </mxCell>
                
                <!-- Reverse Proxy Layer -->
                <mxCell id="10" value="REVERSE PROXY (Nginx)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E74C3C;strokeColor=#C0392B;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="40" y="200" width="720" height="140" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="SSL/TLS&#xa;Let's Encrypt" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E74C3C;strokeColor=#C0392B;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="80" y="240" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="Security Headers&#xa;CSP, HSTS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E74C3C;strokeColor=#C0392B;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="280" y="240" width="160" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="13" value="Reverse Proxy&#xa;:80 / :443" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E74C3C;strokeColor=#C0392B;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="480" y="240" width="160" height="60" as="geometry"/>
                </mxCell>
                
                <!-- Backend Layer -->
                <mxCell id="20" value="BACKEND (Node.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="40" y="380" width="720" height="180" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="Security Middleware&#xa;Helmet, CORS, Rate Limit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="80" y="420" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="22" value="Express API&#xa;REST Endpoints" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="320" y="420" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="Passport.js&#xa;OAuth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="500" y="420" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="JWT Auth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="80" y="500" width="120" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Data Layer -->
                <mxCell id="30" value="DATA LAYER" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F39C12;strokeColor=#D68910;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="40" y="600" width="360" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="31" value="MongoDB&#xa;:27017" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#F39C12;strokeColor=#D68910;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="80" y="640" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="HashiCorp Vault&#xa;Secrets" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#F39C12;strokeColor=#D68910;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="240" y="640" width="120" height="60" as="geometry"/>
                </mxCell>
                
                <!-- External Services -->
                <mxCell id="40" value="EXTERNAL SERVICES" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9B59B6;strokeColor=#8E44AD;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="840" y="40" width="280" height="280" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="Stripe API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9B59B6;strokeColor=#8E44AD;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="880" y="80" width="200" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="42" value="Google OAuth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9B59B6;strokeColor=#8E44AD;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="880" y="140" width="200" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="43" value="GitHub OAuth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9B59B6;strokeColor=#8E44AD;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="880" y="200" width="200" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="44" value="Discord OAuth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9B59B6;strokeColor=#8E44AD;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="880" y="260" width="200" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Monitoring -->
                <mxCell id="50" value="MONITORING" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ABC9C;strokeColor=#16A085;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="840" y="360" width="280" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="51" value="Prometheus&#xa;Metrics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ABC9C;strokeColor=#16A085;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="880" y="400" width="200" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="52" value="Grafana&#xa;Dashboard" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ABC9C;strokeColor=#16A085;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="880" y="460" width="200" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="53" value="Alertmanager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ABC9C;strokeColor=#16A085;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="880" y="520" width="200" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Arrows -->
                <mxCell id="60" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#34495E;" edge="1" parent="1" source="3" target="11">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="61" value="HTTPS" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#34495E;" vertex="1" connectable="0" parent="60">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <mxCell id="62" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#34495E;" edge="1" parent="1" source="13" target="21">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#34495E;" edge="1" parent="1" source="22" target="31">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="64" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#34495E;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="22" target="41">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#34495E;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="23" target="42">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                
                <mxCell id="66" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#34495E;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="22" target="51">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="700" y="450"/>
                            <mxPoint x="700" y="420"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                
                <!-- Title -->
                <mxCell id="70" value="NT219 Security Architecture - System Overview" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="200" y="760" width="720" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Legend -->
                <mxCell id="80" value="Legend" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="840" y="600" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="81" value="Client Layer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A90E2;strokeColor=#2E5C8A;fontColor=#FFFFFF;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="840" y="640" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="82" value="Proxy Layer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E74C3C;strokeColor=#C0392B;fontColor=#FFFFFF;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="840" y="680" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="83" value="Backend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="1000" y="640" width="120" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="84" value="Data Layer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F39C12;strokeColor=#D68910;fontColor=#FFFFFF;fontSize=12;" vertex="1" parent="1">
                    <mxGeometry x="1000" y="680" width="120" height="30" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    
    <diagram id="auth-flow" name="2. Login Flow Sequence">
        <mxGraphModel dx="1422" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                
                <!-- Title -->
                <mxCell id="2" value="Local Login Flow with 2FA" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="400" y="20" width="800" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Actors/Systems -->
                <mxCell id="10" value="User" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#4A90E2;strokeColor=#2E5C8A;" vertex="1" parent="1">
                    <mxGeometry x="100" y="100" width="30" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="React App" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A90E2;strokeColor=#2E5C8A;fontColor=#FFFFFF;fontSize=14;fontStyle=1;" vertex="1" parent="1">
                    <mxGeometry x="300" y="110" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="Backend API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;fontSize=14;fontStyle=1;" vertex="1" parent="1">
                    <mxGeometry x="580" y="110" width="120" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="13" value="MongoDB" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#F39C12;strokeColor=#D68910;fontColor=#FFFFFF;fontSize=14;fontStyle=1;" vertex="1" parent="1">
                    <mxGeometry x="880" y="100" width="80" height="60" as="geometry"/>
                </mxCell>
                
                <!-- Lifelines -->
                <mxCell id="20" value="" style="line;strokeWidth=2;html=1;strokeColor=#95A5A6;dashed=1;" vertex="1" parent="1">
                    <mxGeometry x="115" y="180" width="0" height="600" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="" style="line;strokeWidth=2;html=1;strokeColor=#95A5A6;dashed=1;" vertex="1" parent="1">
                    <mxGeometry x="360" y="180" width="0" height="600" as="geometry"/>
                </mxCell>
                <mxCell id="22" value="" style="line;strokeWidth=2;html=1;strokeColor=#95A5A6;dashed=1;" vertex="1" parent="1">
                    <mxGeometry x="640" y="180" width="0" height="600" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="" style="line;strokeWidth=2;html=1;strokeColor=#95A5A6;dashed=1;" vertex="1" parent="1">
                    <mxGeometry x="920" y="180" width="0" height="600" as="geometry"/>
                </mxCell>
                
                <!-- Message 1 -->
                <mxCell id="30" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2C3E50;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="115" y="220" as="sourcePoint"/>
                        <mxPoint x="360" y="220" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="31" value="Enter email &amp; password" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#2C3E50;fontSize=12;" vertex="1" connectable="0" parent="30">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint x="10" y="-10" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <!-- Message 2 -->
                <mxCell id="32" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2C3E50;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="360" y="260" as="sourcePoint"/>
                        <mxPoint x="640" y="260" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="33" value="POST /api/v1/auth/login" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#2C3E50;fontSize=12;" vertex="1" connectable="0" parent="32">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint x="10" y="-10" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <!-- Processing Box -->
                <mxCell id="40" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ECF0F1;strokeColor=#95A5A6;" vertex="1" parent="1">
                    <mxGeometry x="580" y="300" width="120" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="1. Validate (Joi)&#xa;2. Rate limit check&#xa;3. Find user&#xa;4. Check locked&#xa;5. bcrypt.compare()&#xa;6. Check verified&#xa;7. Check 2FA" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="590" y="310" width="100" height="140" as="geometry"/>
                </mxCell>
                
                <!-- Message 3 -->
                <mxCell id="50" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#E74C3C;dashed=1;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="640" y="500" as="sourcePoint"/>
                        <mxPoint x="360" y="500" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="51" value="200 OK {requiresTwoFactor: true}" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#E74C3C;fontSize=12;fontStyle=1;" vertex="1" connectable="0" parent="50">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint x="-10" y="-10" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <!-- Message 4 -->
                <mxCell id="52" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2C3E50;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="115" y="540" as="sourcePoint"/>
                        <mxPoint x="360" y="540" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="53" value="Enter 6-digit 2FA code" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#2C3E50;fontSize=12;" vertex="1" connectable="0" parent="52">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint x="10" y="-10" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <!-- Message 5 -->
                <mxCell id="54" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#2C3E50;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="360" y="580" as="sourcePoint"/>
                        <mxPoint x="640" y="580" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="55" value="POST /auth/login/2fa" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#2C3E50;fontSize=12;" vertex="1" connectable="0" parent="54">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint x="10" y="-10" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <!-- Processing Box 2 -->
                <mxCell id="60" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ECF0F1;strokeColor=#95A5A6;" vertex="1" parent="1">
                    <mxGeometry x="580" y="620" width="120" height="100" as="geometry"/>
                </mxCell>
                <mxCell id="61" value="Verify TOTP&#xa;Generate tokens&#xa;Save to DB&#xa;Set cookie" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="590" y="630" width="100" height="80" as="geometry"/>
                </mxCell>
                
                <!-- Database interaction -->
                <mxCell id="70" value="" style="endArrow=classic;html=1;strokeWidth=2;strokeColor=#F39C12;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="640" y="680" as="sourcePoint"/>
                        <mxPoint x="920" y="680" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="71" value="Save refresh token" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#F39C12;fontSize=12;" vertex="1" connectable="0" parent="70">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint x="10" y="-10" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <!-- Success response -->
                <mxCell id="80" value="" style="endArrow=classic;html=1;strokeWidth=3;strokeColor=#2ECC71;dashed=1;" edge="1" parent="1">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="640" y="740" as="sourcePoint"/>
                        <mxPoint x="360" y="740" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="81" value="✅ 200 OK + JWT tokens + Cookie" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#2ECC71;fontSize=14;fontStyle=1;" vertex="1" connectable="0" parent="80">
                    <mxGeometry x="-0.1" y="2" relative="1" as="geometry">
                        <mxPoint x="-20" y="-10" as="offset"/>
                    </mxGeometry>
                </mxCell>
                
                <!-- Note -->
                <mxCell id="90" value="Security Features:&#xa;✓ Rate limiting (5 attempts/min)&#xa;✓ Account lockout (5 failed → 15min)&#xa;✓ bcrypt password hashing (12 rounds)&#xa;✓ TOTP 2FA verification&#xa;✓ Device fingerprinting&#xa;✓ Refresh token rotation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF3CD;strokeColor=#F39C12;align=left;verticalAlign=top;fontSize=11;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="1080" y="200" width="300" height="140" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    
    <diagram id="oauth-flow" name="3. OAuth2 Flow">
        <mxGraphModel dx="1422" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                
                <!-- Content for OAuth2 flow - similar structure to auth-flow -->
                <mxCell id="2" value="GitHub OAuth2 Authentication Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="400" y="20" width="800" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Note: Full OAuth flow diagram would be here -->
                <mxCell id="10" value="This diagram shows the complete OAuth2 flow with GitHub.&#xa;&#xa;Steps include:&#xa;1. User clicks 'Login with GitHub'&#xa;2. Redirect to GitHub authorization page&#xa;3. User approves access&#xa;4. GitHub redirects back with code&#xa;5. Backend exchanges code for access token&#xa;6. Backend fetches user profile&#xa;7. Create or update user in database&#xa;8. Issue JWT tokens&#xa;9. Redirect to frontend with token" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F5E9;strokeColor=#4CAF50;align=left;verticalAlign=top;fontSize=14;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="200" y="100" width="1200" height="200" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
    
    <diagram id="security-layers" name="4. Security Layers">
        <mxGraphModel dx="1422" dy="844" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                
                <mxCell id="2" value="Defense in Depth - 7 Security Layers" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#2C3E50;" vertex="1" parent="1">
                    <mxGeometry x="400" y="20" width="800" height="40" as="geometry"/>
                </mxCell>
                
                <!-- Layer 1 -->
                <mxCell id="10" value="Layer 1: Network &amp; Infrastructure" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E74C3C;strokeColor=#C0392B;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="100" y="100" width="1400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="HTTPS/TLS | Nginx Proxy | Docker Isolation | Firewall (UFW)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="100" y="140" width="1400" height="30" as="geometry"/>
                </mxCell>
                
                <!-- Layer 2 -->
                <mxCell id="20" value="Layer 2: Application Security" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E67E22;strokeColor=#D35400;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="100" y="200" width="1400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="CORS Policy | CSP Headers | Rate Limiting | Helmet Headers | Secure Cookies" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="100" y="240" width="1400" height="30" as="geometry"/>
                </mxCell>
                
                <!-- Layer 3 -->
                <mxCell id="30" value="Layer 3: Input Validation &amp; Sanitization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F39C12;strokeColor=#D68910;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="100" y="300" width="1400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="31" value="Joi Schema | MongoDB Sanitize | HPP Protection | Password Policy | File Validation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="100" y="340" width="1400" height="30" as="geometry"/>
                </mxCell>
                
                <!-- Layer 4 -->
                <mxCell id="40" value="Layer 4: Authentication" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ECC71;strokeColor=#27AE60;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="100" y="400" width="1400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="JWT + Fingerprint | Token Versioning | Refresh Rotation | 2FA TOTP | OAuth2 | Account Lockout" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="100" y="440" width="1400" height="30" as="geometry"/>
                </mxCell>
                
                <!-- Layer 5 -->
                <mxCell id="50" value="Layer 5: Authorization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498DB;strokeColor=#2980B9;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="100" y="500" width="1400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="51" value="RBAC (user/admin) | Email Verification | Resource Ownership | Admin-only Routes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="100" y="540" width="1400" height="30" as="geometry"/>
                </mxCell>
                
                <!-- Layer 6 -->
                <mxCell id="60" value="Layer 6: Data Protection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9B59B6;strokeColor=#8E44AD;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="100" y="600" width="1400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="61" value="AES-256-GCM Encryption | bcrypt Hashing (12 rounds) | SHA-256 Token Hash | Field-level Encryption" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="100" y="640" width="1400" height="30" as="geometry"/>
                </mxCell>
                
                <!-- Layer 7 -->
                <mxCell id="70" value="Layer 7: Monitoring &amp; Incident Response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ABC9C;strokeColor=#16A085;fontColor=#FFFFFF;fontSize=16;fontStyle=1;verticalAlign=top;" vertex="1" parent="1">
                    <mxGeometry x="100" y="700" width="1400" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="71" value="Audit Logging | Prometheus Metrics | Email Alerts | Admin Dashboard | Security Events" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFFFFF;" vertex="1" parent="1">
                    <mxGeometry x="100" y="740" width="1400" height="30" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>
